### CP353: Systems Analysis and Design Homework 2  
---
#### Author: Yanapatt Pankaseam ID: 66102010236  
#### Topic: Code Smells Incomplete Library Class 
---

#### ความหมาย 
อย่างที่ทราบกันดีว่าใน Programming Language โดยส่วนใหญ่จะมีสิ่งที่เรียกว่า Library ซึ่งมันสามารถช่วยให้เราประหยัดเวลาและเงินในการพัฒนา Sotfware โดยเราจะเริ่มเจอปัญหา Code Smells Incomplete Library
Class เมื่อพบว่า Library ที่เรากำลังใช้งานอยู่ที่ดูเหมือนว่าจะมีสิ่งที่เราต้องการใช้งานครบถ้วนแล้ว แต่มันดันขาดอะไรบางอย่างไปและเราก็ไม่สามารถที่จะ Modify Library นั้น ๆ ได้ ซึ่งอาจจะเกิดจากผู้เขียน Library 
ไม่ได้จัดเตรียม Feature นั้นเอาไว้หรือปฎิเสธที่จะเพิ่ม Feature เหล่านั้นเข้ามา ส่งผลให้เราต้องเขียน Logic เพิ่มเติมใน Code เองเพื่อชดเชยในสิ่งที่ Library ไม่มี ถ้าหาก Logic ที่เราเขียนเองจำเป็นต้องใช้หลายจุดใน Code และมีการ Modify จะทำให้เราต้องแก้ Code มากกว่าหนึ่งจุดเป็นสาเหตุของการเกิดปัญหา Code Duplicate ตามมา

#### ตัวอย่างโค้ดที่เกิด Code Smell  
สมมติว่านี่คือ Library จัดการวันที่ชื่อ ExternalDateLib.dll ซึ่งเราไม่สามารถ Modify ได้
```
// ExternalDateLib.dll
public sealed class SimpleDate 
{
    public DateTime Value { get; private set; }

    public SimpleDate(DateTime date) {
        Value = date;
    }

    public void AddDays(int days) {
        Value = Value.AddDays(days);
    }
}
```
เราต้องการ Function ที่เช็คว่าเป็นวันหยุดสุดสัปดาห์หรือไม่? (IsWeekend) แต่ Library ไม่มีให้ใช้ เราเลยต้องเขียน Logic เช็คเองซ้ำๆ (Duplicate)
```
// Client Code
public class PayrollSystem 
{
    public void CalculatePay(SimpleDate workDate) 
    {
        // Code Smell: ต้องมาเขียน Logic เช็ควันเสาร์อาทิตย์เอง
        bool isWeekend = workDate.Value.DayOfWeek == DayOfWeek.Saturday || 
                         workDate.Value.DayOfWeek == DayOfWeek.Sunday;

        if (isWeekend) {
            Console.WriteLine("Paying Overtime Rate (x2)");
        } else {
            Console.WriteLine("Paying Normal Rate");
        }
    }
}

public class SystemLog 
{
    public void LogLogin(SimpleDate loginDate) 
    {
        // Code Smell: ต้องมาเขียน Logic เช็ควันเสาร์อาทิตย์เอง เช่นกัน
        bool isWeekend = loginDate.Value.DayOfWeek == DayOfWeek.Saturday || 
                         loginDate.Value.DayOfWeek == DayOfWeek.Sunday;

        if (isWeekend) {
            Console.WriteLine("Warning: Login during weekend!");
        }
    }
}
```

#### ตัวอย่างโค้ดที่ Refactoring แล้ว
เราจะสร้าง Static Class สำหรับเก็บ Extension ที่มีการเรียกใช้มากกว่าหนึ่งจุด โดยวิธีนี้มีชื่อว่า Foreign Method
```
// Client Code
public static class DateUtils
{
    // เพิ่ม Method นี้เข้าไปใน class SimpleDate
    public static bool IsWeekend(this SimpleDate date) 
    {   
        return date.Value.DayOfWeek == DayOfWeek.Saturday || 
               date.Value.DayOfWeek == DayOfWeek.Sunday;
    }
}

public class PayrollSystem 
{
    public void CalculatePay(SimpleDate workDate) 
    {  
        if (workDate.IsWeekend()) {
            Console.WriteLine("Paying Overtime Rate (x2)");
        } else {
            Console.WriteLine("Paying Normal Rate");
        }
    }
}

public class SystemLog 
{
    public void LogLogin(SimpleDate loginDate) 
    {
        if (loginDate.IsWeekend()) {
            Console.WriteLine("Warning: Login during weekend!");
        } 
    }
}
```

#### กรณีที่ Code Smell นี้ไม่ได้บ่งบอกถึงโค้ดที่มีปัญหา (กรณีที่ไม่จำเป็นต้อง Refactoring)
1. เมื่อ Logic ที่เรา Extend ขึ้นมาใหม่จาก Library นั้นถูกใช้เพียงครั้งเดียว การสร้าง Extension Method หรือ Subclass เพื่อ Logic ที่ใช้ครั้งเดียวเป็นการเพิ่มขยะให้กับ Namespace และทำให้ API ของ Library บวมโดยไม่จำเป็น
2. เมื่อ Library นั้นกำลังจะถูกเปลี่ยน เช่น ภายในทีมมีแผนจะเปลี่ยนจาก Library A ไปเป็น Library B ในอีก 1 เดือนข้างหน้า การไปเสียเวลาเขียน Wrapper หรือ Extension ให้กับ Library ที่กำลังจะเลิกใช้ทำให้เราเหนื่อยโดยไม่จำเป็น

---
### References
1. Code Smells | Incomplete Library Class: https://luzkan.github.io/smells/incomplete-library-class
2. Incomplete Library Class: https://refactoring.guru/smells/incomplete-library-class
3. C# Code Smells Example: https://gemini.google.com/app?hl=th
